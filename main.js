require("source-map-support/register"),module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=41)}([function(e,t,n){"use strict";n.d(t,"g",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return d}));var r="STUDENT",o="ADMIN",i="JUDGE",a=1,u=2,s=3,c=new Set(["youtube","vimeo"]),d=new Set([0,1,2])},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("graphql-errors")},function(e,t,n){"use strict";var r=n(15),o=n(18),i=n(12),a=n(13),u=n(4),s=n(9),c=n(1),d=n.n(c),l=n(5),p=n(0),f=l.a.define("entry",{academicProgram:{allowNull:!0,type:d.a.TEXT},awardWon:{type:d.a.TEXT},comment:{type:d.a.TEXT},distributionAllowed:{type:d.a.BOOLEAN},entryType:{allowNull:!1,type:d.a.INTEGER},entryId:{allowNull:!1,type:d.a.INTEGER},excludeFromJudging:{allowNull:!1,type:d.a.BOOLEAN,defaultValue:!1},forSale:{allowNull:!1,defaultValue:!1,type:d.a.BOOLEAN},groupId:{allowNull:!0,type:d.a.INTEGER,references:{model:"groups",key:"id"},onDelete:"cascade",onUpdate:"cascade"},invited:{allowNull:!0,type:d.a.BOOLEAN},moreCopies:{allowNull:!1,defaultValue:!1,type:d.a.BOOLEAN},portfolioId:{allowNull:!0,type:d.a.INTEGER,references:{model:"portfolios",key:"id"},onDelete:"cascade",onUpdate:"cascade"},showId:{allowNull:!0,type:d.a.INTEGER,references:{model:"shows",key:"id"},onDelete:"cascade",onUpdate:"cascade"},studentUsername:{allowNull:!0,type:d.a.STRING,references:{model:"users",key:"username"},onDelete:"cascade",onUpdate:"cascade"},title:{type:d.a.STRING,defaultValue:"Untitled",allowNull:!1},yearLevel:{allowNull:!0,type:d.a.TEXT},createdAt:{allowNull:!1,type:d.a.DATE},updatedAt:{allowNull:!1,type:d.a.DATE}},{validate:{entrantPresentValidation:function(){if(!this.studentUsername&&!this.groupId)throw new Error("Entry must have an entrant")}}});f.prototype.getScore=function(){return s.a.findAll({where:{entryId:this.id}}).then((function(e){var t=e.map((function(e){return e.value}));return 0===t.length?0:t.reduce((function(e,t){return e+t}))/t.length}))},f.prototype.getImage=function(){return this.entryType!==p.d?Promise.resolve(null):this.imagePromise?this.imagePromise:this.imagePromise=r.a.findOne({where:{id:this.entryId}})},f.prototype.getVideo=function(){return this.entryType!==p.h?Promise.resolve(null):this.videoPromise?this.videoPromise:this.videoPromise=o.a.findOne({where:{id:this.entryId}})},f.prototype.getOther=function(){return this.entryType!==p.f?Promise.resolve(null):this.otherPromise?this.otherPromise:this.otherPromise=i.a.findOne({where:{id:this.entryId}})},f.prototype.getGroup=function(){return this.isGroupSubmission()?a.a.findByPk(this.groupId):Promise.resolve(null)},f.prototype.getStudent=function(){return this.isStudentSubmission()?u.a.findByPk(this.studentUsername):Promise.resolve(null)},f.prototype.isGroupSubmission=function(){return Number.isInteger(this.groupId)},f.prototype.isStudentSubmission=function(){return!!this.studentUsername},t.a=f},function(e,t,n){"use strict";var r=n(13),o=n(1),i=n.n(o),a=n(5),u=n(0),s=n(3),c=n(8),d=a.a.define("user",{username:{type:i.a.STRING,allowNull:!1,notEmpty:!0,primaryKey:!0},firstName:{type:i.a.STRING,allowNull:!1,notEmpty:!0},lastName:{type:i.a.STRING,allowNull:!1,notEmpty:!0},hometown:{type:i.a.STRING,allowNull:!0},displayName:{type:i.a.STRING,allowNull:!0},type:{type:i.a.ENUM(u.g,u.a,u.e),allowNull:!1,notEmpty:!0}});d.prototype.getGroups=function(){return this.type!==u.g?Promise.resolve([]):r.a.findAll({where:{creatorUsername:this.username}})},d.prototype.getOwnAndGroupEntries=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.type!==u.g?Promise.resolve([]):this.getGroups().then((function(n){var r=n.map((function(e){return e.id}));return t?s.a.findAll({where:{$or:[{groupId:r},{studentUsername:e.username}],showId:t}}):s.a.findAll({where:{$or:[{groupId:r},{studentUsername:e.username}]}})}))},c.a.prototype.getPortfolio=function(){return c.a.findOne({where:{studentUsername:this.username}})},t.a=d},function(e,t,n){"use strict";var r=n(1),o=n.n(r),i=n(6),a=i.a.get("ABSTRACTION_DB_NAME"),u=i.a.get("ABSTRACTION_DB_USER"),s=i.a.get("ABSTRACTION_DB_PASS"),c=i.a.get("ABSTRACTION_DB_HOST"),d=o.a.Op,l={$eq:d.eq,$ne:d.ne,$gte:d.gte,$gt:d.gt,$lte:d.lte,$lt:d.lt,$not:d.not,$in:d.in,$notIn:d.notIn,$is:d.is,$like:d.like,$notLike:d.notLike,$iLike:d.iLike,$notILike:d.notILike,$regexp:d.regexp,$notRegexp:d.notRegexp,$iRegexp:d.iRegexp,$notIRegexp:d.notIRegexp,$between:d.between,$notBetween:d.notBetween,$overlap:d.overlap,$contains:d.contains,$contained:d.contained,$adjacent:d.adjacent,$strictLeft:d.strictLeft,$strictRight:d.strictRight,$noExtendRight:d.noExtendRight,$noExtendLeft:d.noExtendLeft,$and:d.and,$or:d.or,$any:d.any,$all:d.all,$values:d.values,$col:d.col},p={development:{dialect:"mysql",host:c,database:a,username:u,password:s,port:3306,operatorsAliases:l,charset:"utf8mb4"},test:{dialect:"mysql",host:c,database:"test",username:u,password:s,port:3306,logging:!1,operatorsAliases:l,charset:"utf8mb4"}}[i.a.get("NODE_ENV")];t.a=new o.a(p.database,p.username,p.password,p)},function(e,t,n){"use strict";var r=n(30);n.n(r).a.config();var o=n(21),i=n.n(o),a=n(11),u=n.n(a),s=u.a.existsSync("./keys/private.key")?u.a.readFileSync("./keys/private.key","utf-8"):"",c=u.a.existsSync("./keys/public.key")?u.a.readFileSync("./keys/public.key","utf-8"):"",d={jwt:{secret:s.toString(),pub:c.toString(),expiresInMinutes:2880,downloadTokenExpiresInMinutes:5},saml:{finalUrl:process.env.SAML_SUCCESS_URL,callbackUrl:process.env.SAML_CALLBACK_URL,entryPoint:process.env.SAML_ENTRY_POINT,issuer:process.env.ISSUER,decryptionPvk:s,privateCert:s,publicCert:c,cert:u.a.readFileSync("./keys/idp_cert.pem","utf8").toString()}},l={imageDir:"./uploads/images",pdfDir:"./uploads/pdfs"};i.a.argv().env().use("memory"),i.a.set("auth",d),i.a.set("upload",l),i.a.defaults({NODE_ENV:"development"});t.a=i.a},function(e,t,n){"use strict";var r=n(1),o=n.n(r),i=n(5),a=n(3),u=i.a.define("show",{name:{type:o.a.STRING,allowNull:!1,notEmpty:!0},description:{type:o.a.STRING,allowNull:!1,defaultValue:""},entryCap:{type:o.a.INTEGER,allowNull:!1,min:1},entryStart:{type:o.a.DATE,allowNull:!1},entryEnd:{type:o.a.DATE,allowNull:!1},judgingStart:{type:o.a.DATE,allowNull:!1},judgingEnd:{type:o.a.DATE,allowNull:!1},finalized:{type:o.a.BOOLEAN,allowNull:!1,defaultValue:!1}},{validate:{entryAndJudingDateValidation:function(){var e=new Date(this.entryStart),t=new Date(this.entryEnd),n=new Date(this.judgingStart),r=new Date(this.judgingEnd);if(e>t)throw new Error("Entry start date must be before the entry end date");if(t>=n)throw new Error("Entry end date must be before or equal to the judging start date");if(n>r)throw new Error("Judging start date must be before the judging end date")}}});u.prototype.getEntries=function(){return a.a.findAll({where:{showId:this.id}})},t.a=u},function(e,t,n){"use strict";var r=n(1),o=n.n(r),i=n(5),a=n(3),u=i.a.define("portfolio",{title:{type:o.a.STRING,allowNull:!1,notEmpty:!0},studentUsername:{allowNull:!0,type:o.a.STRING,references:{model:"users",key:"username"},onDelete:"cascade",onUpdate:"cascade"},name:{type:o.a.STRING,allowNull:!0},portfolioPeriodId:{type:o.a.INTEGER,references:{model:"portfolioPeriods",key:"id"},onDelete:"no action",onUpdate:"cascade"}});u.prototype.getEntries=function(){return a.a.findAll({where:{portfolioId:this.id}})},t.a=u},function(e,t,n){"use strict";var r=n(4),o=n(3),i=n(1),a=n.n(i),u=n(5),s=n(0),c=u.a.define("vote",{judgeUsername:{type:a.a.STRING,allowNull:!1,references:{model:"users",key:"username"},onDelete:"cascade",onUpdate:"cascade"},entryId:{type:a.a.INTEGER,allowNull:!1,references:{model:"entry",key:"id"},onDelete:"cascade",onUpdate:"cascade"},value:{type:a.a.INTEGER,allowNull:!1}},{validate:{voteValueValidation:function(){if(!s.c.has(this.value))throw new Error("Vote value must be 0, 1, or 2")}}});c.prototype.getJudge=function(){return this.judgeUsername?r.a.findByPk(this.judgeUsername):Promise.resolve(null)},c.prototype.getEntry=function(){return this.entryId?o.a.findByPk(this.entryId):Promise.resolve(null)},t.a=c},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=n(3),o=n(0),i=n(1),a=n.n(i),u=n(5).a.define("other",{path:{type:a.a.STRING,allowNull:!0},createdAt:{allowNull:!1,type:a.a.DATE},updatedAt:{allowNull:!1,type:a.a.DATE}});u.prototype.getEntry=function(){return r.a.findOne({where:{entryType:o.f,entryId:this.id}})},t.a=u},function(e,t,n){"use strict";var r=n(1),o=n.n(r),i=n(5),a=n(4),u=i.a.define("group",{creatorUsername:{allowNull:!1,type:o.a.STRING,references:{model:"users",key:"username"},onDelete:"cascade",onUpdate:"cascade"},participants:{allowNull:!1,type:o.a.STRING},createdAt:{allowNull:!1,type:o.a.DATE},updatedAt:{allowNull:!1,type:o.a.DATE}});u.prototype.getCreator=function(){return this.creatorUsername?a.a.findByPk(this.creatorUsername):Promise.resolve(null)},t.a=u},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";var r=n(3),o=n(0),i=n(1),a=n.n(i),u=n(5).a.define("image",{path:{type:a.a.STRING,allowNull:!1,notEmpty:!0},horizDimInch:{type:a.a.FLOAT,allowNull:!1},vertDimInch:{type:a.a.FLOAT,allowNull:!1},mediaType:{type:a.a.STRING,allowNull:!1,notEmpty:!0},createdAt:{allowNull:!1,type:a.a.DATE},updatedAt:{allowNull:!1,type:a.a.DATE}},{validate:{dimensionsPositiveValidation:function(){if(this.vertDimInch<=0)throw new Error("vertDimInch must be positive");if(this.horizDimInch<=0)throw new Error("horizDimInch must be positive")}}});u.prototype.getEntry=function(){return r.a.findOne({where:{entryType:o.d,entryId:this.id}})},t.a=u},function(e,t){e.exports=require("moment-timezone")},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";var r=n(3),o=n(0),i=n(1),a=n.n(i),u=n(5).a.define("video",{provider:{type:a.a.STRING,allowNull:!1,notEmpty:!0},videoId:{type:a.a.STRING,allowNull:!1,notEmpty:!0},createdAt:{allowNull:!1,type:a.a.DATE},updatedAt:{allowNull:!1,type:a.a.DATE}},{validate:{allowed_provider:function(){if(!o.b.has(this.provider))throw new Error("Video source must be from youtube or vimeo")}}});u.prototype.getEntry=function(){return r.a.findOne({where:{entryType:o.h,entryId:this.id}})},t.a=u},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u}));var r=n(26),o=n.n(r),i=n(6).a.get("auth:jwt");function a(e){return o.a.verify(e,i.pub,{algorithm:"RS256"})}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.expiresIn=t.expiresIn||6e4*i.expiresInMinutes,o.a.sign(e,i.secret,{algorithm:"RS256",expiresIn:t.expiresIn})}},function(e,t,n){"use strict";n.d(t,"b",(function(){return f}));var r=n(22),o=n.n(r);n.d(t,"a",(function(){return o.a}));var i=n(31),a=n(6),u=n(4),s=n(0);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}var p=a.a.get("auth:saml"),f=new i.Strategy({callbackUrl:p.callbackUrl,entryPoint:p.entryPoint,issuer:p.issuer,identifierFormat:null,decryptionPvk:p.decryptionPvk,privateCert:p.privateCert,cert:p.cert,validateInResponseTo:!1,disableRequestedAuthnContext:!0},function(){var e,t=(e=regeneratorRuntime.mark((function e(t,n){var r,o,i,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("production"!==a.a.get("NODE_ENV")&&(t.uid=t.email.replace("@example.com",""),t.givenName="Unknown",t.sn="Unknown"),t.uid&&t.givenName&&t.sn){e.next=3;break}return e.abrupt("return",n("Profile is missing a property",null));case 3:return e.next=5,u.a.findOrCreate({where:{username:t.uid},defaults:{firstName:t.givenName,lastName:t.sn,type:s.g}});case 5:return r=e.sent,o=c(r,2),i=o[0],d=o[1],e.next=11,Promise.all([i.save(),d]);case 11:l=e.sent,n(null,l[0]);case 13:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){l(i,r,o,a,u,"next",e)}function u(e){l(i,r,o,a,u,"throw",e)}a(void 0)}))});return function(e,n){return t.apply(this,arguments)}}());o.a.serializeUser((function(e,t){t(null,e)})),o.a.deserializeUser((function(e,t){t(null,e)})),o.a.use(f)},function(e,t){e.exports=require("nconf")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("multer")},function(e,t,n){"use strict";(function(e){var r=n(14),o=n.n(r),i=n(29),a=n.n(i),u=n(10),s=n.n(u),c=(n(42),n(43),n(6)),d=n(20),l=n(32),p=n(40),f=n(37),h=s()();Object(l.a)(),h.disable("x-powered-by"),"production"!==c.a.get("NODE_ENV")&&h.use(a()()),h.use(s.a.json({limit:"10gb"})),h.use(s.a.urlencoded({extended:!1})),h.use(d.a.initialize()),h.use(f.a),h.use(p.a),h.use("/static/uploads",s.a.static(o.a.join(e,"uploads","images"))),h.use("/static/uploads",s.a.static(o.a.join(e,"uploads","pdfs"))),t.a=h}).call(this,"")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("archiver")},function(e,t){e.exports=require("apollo-server-express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("passport-saml")},function(e,t,n){"use strict";var r=n(3),o=n(13),i=n(4),a=n(7),u=n(8);t.a=function(){i.a.belongsToMany(a.a,{through:"user_shows",foreignKey:"username"}),a.a.belongsToMany(i.a,{through:"user_shows"}),r.a.belongsTo(i.a,{foreignKey:"studentUsername"}),r.a.belongsTo(o.a,{foreignKey:"groupId"}),r.a.belongsTo(a.a,{foreignKey:"showId"}),r.a.belongsTo(u.a,{foreignKey:"portfolioId"}),u.a.belongsTo(i.a,{foreignKey:"studentUsername"})}},function(e,t){e.exports=require("mkdirp")},function(e,t){e.exports=require("uuid")},function(e,t){e.exports=require("sharp")},function(e,t){e.exports=require("csv-stringify")},function(e,t,n){"use strict";var r=n(19),o=n(6),i=n(0);function a(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function u(e){a(i,r,o,u,s,"next",e)}function s(e){a(i,r,o,u,s,"throw",e)}u(void 0)}))}}function s(){return(s=u(regeneratorRuntime.mark((function e(t,n,a){var u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u={},!t.headers.authorization||0!==t.headers.authorization.indexOf("Bearer ")){e.next=13;break}return s=t.headers.authorization.substr("Bearer ".length),e.prev=3,e.next=6,Object(r.a)(s);case 6:u=e.sent,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),console.error(e.t0),u={};case 13:t.auth=u,t.auth.type=t.auth.type||null,"development"===o.a.get("NODE_ENV")&&t.headers.referer&&0===t.headers.referer.indexOf("http://localhost:3000/graphiql")&&(t.auth.type=i.a),a();case 17:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}t.a=function(e,t,n){return s.apply(this,arguments)}},function(e,t){e.exports=require("graphql")},function(e,t){e.exports=require("graphql/language")},function(e,t,n){"use strict";var r=n(10),o=n(6),i=n(19),a=n(20),u=Object(r.Router)(),s=o.a.get("auth:jwt"),c=o.a.get("auth:saml");u.route("/auth/login").get(a.a.authenticate("saml",{failureRedirect:"/auth/login/fail"}),(function(e,t,n){var r=Object(i.b)(e.user.dataValues);t.cookie("_token_v1",r).redirect(c.finalUrl)})),u.route("/auth/login/callback").post(a.a.authenticate("saml",{failureRedirect:"/auth/login/fail"}),(function(e,t){var n=Object(i.b)(e.user.dataValues);t.cookie("_token_v1",n).redirect(c.finalUrl)})),u.route("/auth/login/fail").get((function(e,t){t.status(401).send("Login failed")})),u.route("/Shibboleth.sso/Metadata").get((function(e,t){t.type("application/xml"),t.status(200).send(a.b.generateServiceProviderMetadata(c.publicCert))})),u.route("/auth/downloadToken").post((function(e,t){if(!e.auth||!e.auth.username||!e.auth.type)return t.status(401).type("json").send({error:"no authentication provided"});var n=6e4*s.downloadTokenExpiresInMinutes,r=Object(i.b)({username:e.auth.username,type:e.auth.type},{expiresIn:n});t.type("application/json").send({token:r})}));var d=u,l=n(24),p=n.n(l),f=n(33),h=n.n(f),y=n(34),m=n(35),g=n.n(m),w=n(14),v=n.n(w),b=n(0),I=Object(r.Router)(),S=o.a.get("upload:imageDir"),P=o.a.get("upload:pdfDir");function O(e,t){return p.a.diskStorage({destination:function(t,n,r){r(null,e)},filename:function(n,r,o){var i=Object(y.v4)();h.a.sync("".concat(e,"/").concat(i[0],"/").concat(i[1])),o(null,"".concat(i[0],"/").concat(i[1],"/").concat(i,".").concat(t))}})}var E=p()({storage:O(S,"jpg"),limits:{fileSize:5e7,files:1},fileFilter:function(e,t,n,r){if("image/jpeg"!==t.mimetype)return n(null,!1);n(null,!0)}}).single("image"),D=p()({storage:O(P,"pdf"),limits:{fileSize:5e7,files:1},fileFilter:function(e,t,n,r){if("application/pdf"!==t.mimetype)return n(null,!1);n(null,!0)}}).single("pdf");function j(e,t,n,r){if(n)return"File too large"===n.message?t.status(413).json({error:"File too large"}):t.status(500).json({error:"Failed to Upload"});if(!e.file)return t.status(400).json({error:"No ".concat(r," Provided")});if("JPEG"===r){var o=g()(e.file.path);o.metadata().then((function(n){var r=n.height,i=n.width,a=0,u=0;r>i?(u=Math.min(300,r),a=Math.floor(u/r*i)):(a=Math.min(400,i),u=Math.floor(a/i*r));var s=v.a.parse(e.file.path),c="".concat(s.dir,"/").concat(s.name,"_thumb").concat(s.ext);return o.resize(a,u).jpeg({progressive:!0}).toFile(c).then((function(){t.status(201).json({path:e.file.filename})}))})).catch((function(e){console.error("Error in generating image thumbnail",e),t.status(500).json({error:"Internal server error"})}))}else t.status(201).json({path:e.file.filename})}function U(e,t,n){var r=e.auth.type;if(r!==b.a&&r!==b.g)return t.status(401).send("Permission Denied");n()}I.route("/static/upload/image").post(U,(function(e,t,n){return E(e,t,(function(n){return j(e,t,n,"JPEG")}))})),I.route("/static/upload/pdf").post(U,(function(e,t,n){return D(e,t,(function(n){return j(e,t,n,"PDF")}))}));var T=I,N=n(11),A=n.n(N),x=n(23),k=n(27),B=n.n(k),R=n(36),G=n.n(R),$=n(17),C=n.n($),L=n(3),V=n(13),_=n(15),F=n(18),z=n(12),q=n(7),M=n(4),J=n(5),Y=n(8);function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||H(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||H(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object(x.promisify)(A.a.readFile);var te=Object(x.promisify)(G.a),ne=o.a.get("upload:imageDir"),re=o.a.get("upload:pdfDir"),oe=Object(r.Router)(),ie=function(e,t,n){var r=e.query.token;n(),Object(i.a)(r,(function(e,r){e||r.type!==b.a?t.status(401).type("html").send("Permission Denied"):n()}))},ae=function(e){var t=function(e){return{studentSubmissions:e.filter((function(e){return e.isStudentSubmission()&&!e.isGroupSubmission()})).reduce((function(e,t){return Z(Z({},e),{},ee({},t.studentUsername,[].concat(W(e[t.studentUsername]||[]),[t])))}),{}),groupSubmissions:e.filter((function(e){return e.isGroupSubmission()})).reduce((function(e,t){return Z(Z({},e),{},ee({},t.groupId,[].concat(W(e[t.groupId]||[]),[t])))}),{})}}(e);return function(e,t){return Promise.all([M.a.findAll({where:{username:{$in:Object.keys(e)}}}),V.a.findAll({where:{id:{$in:Object.keys(t)}}})]).then((function(n){var r=K(n,2),o=r[0],i=r[1],a=o.reduce((function(e,t){return Z(Z({},e),{},ee({},t.username,t))}),{}),u=i.reduce((function(e,t){return Z(Z({},e),{},ee({},t.id,t))}),{}),s=Object.entries(e).map((function(e){var t=K(e,2),n=t[0],r=t[1];return{user:a[n],entries:r}})),c=Object.entries(t).map((function(e){var t=K(e,2),n=t[0],r=t[1],o=u[n];return o.getCreator().then((function(e){return{group:o,user:e,entries:r}}))}));return Promise.all([].concat(W(s),W(c)))}))}(t.studentSubmissions,t.groupSubmissions)};function ue(e,t){return _.a.findAll({where:{id:{$in:t}}}).then((function(t){var n=t.reduce((function(e,t){return Z(Z({},e),{},ee({},t.id,t))}),{});return e.forEach((function(e){e.entryType===b.d&&void 0!==n[e.entryId]&&(e.path=n[e.entryId].path)})),e}))}function se(e){var t=new Set;return e.reduce((function(e,n){var r=n.user,o=n.group,i=n.entries.map((function(e){for(var n=e.path,i=e.title,a=e.invited,u=e.entryType,s="".concat(r.lastName,", ").concat(r.firstName).concat(o?" & ".concat(o.participants):""," - ").concat(i),c=s,d=1;t.has(c);)c="".concat(s," (").concat(d,")"),d+=1;return t.add(c),{name:"".concat(c,".").concat(u===b.d?"jpg":"pdf"),path:n,invited:a,entryType:u}}));return[].concat(W(e),W(i))}),[])}oe.route("/csv/:showId").get(ie,(function(e,t,n){q.a.findByPk(e.params.showId,{rejectOnEmpty:!0}).then((function(n){L.a.findAll({where:{showId:e.params.showId}}).then((function(e){var r=[],i=[],a=[];return e.forEach((function(e){e.entryType===b.d?r.push(e.entryId):e.entryType===b.h?i.push(e.entryId):e.entryType===b.f&&a.push(e.entryId)})),Promise.all([_.a.findAll({where:{id:{$in:r}}}),F.a.findAll({where:{id:{$in:i}}}),z.a.findAll({where:{id:{$in:a}}}),ae(e)]).then((function(e){var t=K(e,4),n=t[0],r=t[1],i=t[2],a=t[3],u=n.reduce((function(e,t){return Z(Z({},e),{},ee({},t.id,t))}),{}),s=r.reduce((function(e,t){return Z(Z({},e),{},ee({},t.id,t))}),{}),c=i.reduce((function(e,t){return Z(Z({},e),{},ee({},t.id,t))}),{});return a.reduce((function(e,t){var n=t.user,r=t.group,i=t.entries.map((function(e){var t=e.dataValues,i=e.entryType===b.d?"Image":e.entryType===b.h?"Video":e.entryType===b.f?"Other":"",a={studentEmail:"".concat(t.studentUsername,"@rit.edu"),studentFirstName:n?n.firstName:null,studentLastName:n?n.lastName:null,studentHometown:n?n.hometown:null,studentDisplayName:n?n.displayName:null,isGroupSubmission:!!t.groupId,groupParticipants:r?r.participants:null,entryType:i,title:t.title,comment:t.comment,moreCopies:t.moreCopies,forSale:t.forSale,awardWon:t.awardWon,invited:t.invited,yearLevel:t.yearLevel,academicProgram:t.academicProgram,excludeFromJudging:t.excludeFromJudging,submittedAt:C()(t.createdAt).format(),path:"",horizDimInch:"",vertDimInch:"",mediaType:"",videoUrl:""};if(e.entryType===b.d){var d=u[e.entryId];return Z(Z({},a),{},{path:"".concat(o.a.get("STATIC_UPLOAD_BASE_URL")).concat(d.path),horizDimInch:d.horizDimInch,vertDimInch:d.vertDimInch,mediaType:d.mediaType})}if(e.entryType===b.h){var l=s[e.entryId];if("youtube"===l.provider)return Z(Z({},a),{},{videoUrl:"".concat("https://www.youtube.com/watch?v=").concat(l.videoId)});if("vimeo"===l.provider)return Z(Z({},a),{},{videoUrl:"".concat("https://vimeo.com/").concat(l.videoId)})}else if(e.entryType===b.f){var p=c[e.entryId];return Z(Z({},a),{},{path:"".concat(o.a.get("STATIC_UPLOAD_BASE_URL")).concat(p.path)})}}));return[].concat(W(e),W(i))}),[])})).then((function(e){te(e,{header:!0,columns:{studentEmail:"Student Email",studentFirstName:"Student First Name",studentLastName:"Student Last Name",studentHometown:"Student Homewtown",studentDisplayName:"Student Display Name",isGroupSubmission:"Group Submission?",groupParticipants:"Group Participants",entryType:"Submission Type",title:"Title",comment:"Artist Comment",moreCopies:"More Copies?",forSale:"For Sale?",awardWon:"Award Won?",invited:"Invited?",yearLevel:"Year Level",academicProgram:"Academic Program",excludeFromJudging:"Exclude From Judging?",submittedAt:"Submitted At",path:"File",horizDimInch:"Width (in.)",vertDimInch:"Height (in.)",mediaType:"Media Type",videoUrl:"Video URL"}}).then((function(e){t.status(200).type("text/csv").attachment("".concat(n.name,".csv")).send(e)})).catch((function(e){console.error(e),t.status(500).send("500: Oops! Try again later.")}))}))}))}))})),oe.route("/zips/shows/:showId").get(ie,(function(e,t,n){q.a.findByPk(e.params.showId,{rejectOnEmpty:!0}).then((function(n){L.a.findAll({where:{showId:e.params.showId,entryType:b.d}}).then((function(e){var t=e.map((function(e){return e.entryId}));return ue(e,t)})).then((function(e){return ae(e)})).then((function(e){return se(e)})).then((function(e){var r=B()("tar");t.status(200).type("tar").attachment("".concat(n.name,".tar")),r.pipe(t),e.map((function(e){var t=v.a.join(ne,e.path);r.append(A.a.createReadStream(t),{name:"".concat(n.name,"/").concat(e.invited?"Invited":"Not Invited","/").concat(e.name)})})),r.finalize()}))})).catch(J.a.EmptyResultError,(function(){t.status(404).send("Show Not Found")})).catch((function(e){console.error(e),t.status(500).send("Oops! Try again later.")}))})),oe.route("/zips/portfolio/:portfolioId").get(ie,(function(e,t,n){Y.a.findByPk(e.params.portfolioId,{rejectOnEmpty:!0}).then((function(n){L.a.findAll({where:{portfolioId:e.params.portfolioId}}).then((function(e){var t=e.filter((function(e){return e.entryType===b.d})).map((function(e){return e.entryId}));return ue(e,t)})).then((function(e){var t=e.filter((function(e){return e.entryType===b.f})).map((function(e){return e.entryId}));return function(e,t){return z.a.findAll({where:{id:{$in:t}}}).then((function(t){var n=t.reduce((function(e,t){return Z(Z({},e),{},ee({},t.id,t))}),{});return e.forEach((function(e){e.entryType===b.f&&void 0!==n[e.entryId]&&(e.path=n[e.entryId].path)})),e}))}(e,t)})).then((function(e){return ae(e)})).then((function(e){return se(e)})).then((function(e){var r=B()("tar");t.status(200).type("tar").attachment("".concat(n.title,".tar")),r.pipe(t),e.map((function(e){if(e.entryType!==b.h){var t=e.entryType===b.d?ne:re,o=v.a.join(t,e.path);r.append(A.a.createReadStream(o),{name:"".concat(n.title,"/").concat(e.name)})}})),r.finalize()}))})).catch(J.a.EmptyResultError,(function(){t.status(404).send("Portfolio Not Found")})).catch((function(e){console.error(e),t.status(500).send("Oops! Try again later.")}))}));var ce=oe,de=Object(r.Router)();de.use(d),de.use(T),de.use(ce);t.a=de},function(e,t,n){e.exports=n(44)},function(e,t){e.exports=require("core-js/stable")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"updateEntry",(function(){return ie})),n.d(r,"createPhoto",(function(){return ae})),n.d(r,"createVideo",(function(){return ue})),n.d(r,"createOtherMedia",(function(){return se}));var o={};n.r(o),n.d(o,"entries",(function(){return ce}));var i={};n.r(i),n.d(i,"createPortfolio",(function(){return fe}));var a={};n.r(a),n.d(a,"portfolio",(function(){return me})),n.d(a,"portfolios",(function(){return ge}));var u={};n.r(u),n.d(u,"createPortfolioPeriod",(function(){return Te})),n.d(u,"updatePortfolioPeriod",(function(){return Ae})),n.d(u,"assignJudgesToPortfolioPeriod",(function(){return xe})),n.d(u,"removeJudgesFromPortfolioPeriod",(function(){return Be}));var s={};n.r(s),n.d(s,"portfolioPeriod",(function(){return Ce})),n.d(s,"portfolioPeriods",(function(){return Ve}));var c={};n.r(c),n.d(c,"scholarship",(function(){return Xe})),n.d(c,"scholarships",(function(){return Qe}));var d={};n.r(d),n.d(d,"createScholarship",(function(){return tt})),n.d(d,"updateScholarship",(function(){return rt}));var l={};n.r(l),n.d(l,"scholarshipSubmission",(function(){return ot})),n.d(l,"scholarshipSubmissions",(function(){return it}));var p={};n.r(p),n.d(p,"createScholarshipSubmission",(function(){return st}));var f={};n.r(f),n.d(f,"createShow",(function(){return Pt})),n.d(f,"updateShow",(function(){return Ot})),n.d(f,"deleteShow",(function(){return Et})),n.d(f,"assignToShow",(function(){return Dt})),n.d(f,"removeFromShow",(function(){return jt}));var h={};n.r(h),n.d(h,"show",(function(){return Ut})),n.d(h,"shows",(function(){return Tt}));var y={};n.r(y),n.d(y,"updateUser",(function(){return Rt})),n.d(y,"createAdmin",(function(){return Gt})),n.d(y,"createJudge",(function(){return $t}));var m={};n.r(m),n.d(m,"user",(function(){return Ct})),n.d(m,"self",(function(){return Lt})),n.d(m,"users",(function(){return Vt}));var g={};n.r(g),n.d(g,"vote",(function(){return _t}));var w={};n.r(w),n.d(w,"votes",(function(){return Ft})),n.d(w,"vote",(function(){return zt}));var v=n(25),b=n(6),I=n(28),S=n(38),P=n(39),O={Date:new S.GraphQLScalarType({name:"Date",description:"Date custom scalar type",parseValue:function(e){return new Date(e)},serialize:function(e){return e.toISOString()},parseLiteral:function(e){return e.kind===P.Kind.STRING?new Date(e.value):null}})},E=n(2),D=n(7),j=n(9),U=n(0),T={group:function(e){return e.getGroup()},student:function(e){return e.getStudent()},score:function(e){return e.getScore()},show:function(e){return D.a.findByPk(e.showId)},votes:function(e,t,n){switch(n.authType){case U.a:return j.a.findAll({where:{entryId:e.id}});case U.e:return j.a.findAll({where:{entryId:e.id,judgeUsername:n.username}});default:throw new E.UserError("Students cannot access entry votes")}},entryType:function(e){return e.entryType===U.d?"PHOTO":e.entryType===U.h?"VIDEO":e.entryType===U.f?"OTHER":void 0}},N={Entry:{__resolveType:function(e,t,n){if(e.entryType===U.d)return n.schema.getType("Photo");if(e.entryType===U.h)return n.schema.getType("Video");if(e.entryType===U.f)return n.schema.getType("OtherMedia");throw new Error("Unknown entry type")}}};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B={Photo:x(x({},T),{},{path:function(e){return e.getImage().then((function(e){return e.path}))},horizDimInch:function(e){return e.getImage().then((function(e){return e.horizDimInch}))},vertDimInch:function(e){return e.getImage().then((function(e){return e.vertDimInch}))},mediaType:function(e){return e.getImage().then((function(e){return e.mediaType}))}})};function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){$(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C={Video:G(G({},T),{},{provider:function(e){return e.getVideo().then((function(e){return e.provider}))},videoId:function(e){return e.getVideo().then((function(e){return e.videoId}))}})};function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F={OtherMedia:V(V({},T),{},{path:function(e){return e.getOther().then((function(e){return e.path}))}})},z=n(5),q=n(17),M=n.n(q),J=n(3),Y=n(15),K=n(18),W=n(12),H=n(13),X=n(4);function Q(e,t){return void 0!==t.username&&(e.input.entry.studentUsername?t.username===e.input.entry.studentUsername:!!e.input.entry.group.creatorUsername&&t.username===e.input.entry.group.creatorUsername)}function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne=function(e,t,n,r){var o=Promise.resolve(null);return e.group&&(o=H.a.create({creatorUsername:e.group.creatorUsername,participants:e.group.participants},{transaction:r})),o.then((function(o){var i=Promise.resolve(null);e.studentUsername&&(i=X.a.findByPk(e.studentUsername));var a=Object.assign({},e);return delete a.group,i.then((function(i){var u=Promise.resolve(null);return o||i.hometown===e.hometown||i.displayName===e.displayName?o||i.hometown==e.hometown?o||i.displayName==e.displayName||(u=X.a.update({displayName:e.displayName},{where:{username:e.studentUsername}})):u=X.a.update({hometown:e.hometown},{where:{username:e.studentUsername}}):u=X.a.update({hometown:e.hometown,displayName:e.displayName},{where:{username:e.studentUsername}}),delete a.hometown,u.then((function(){return J.a.create(ee(ee({},a),{},{entryType:t,entryId:n,groupId:o?o.id:null}),{transaction:r})}))}))})).then((function(){return e.showId?D.a.findByPk(e.showId):Promise.resolve()}))},re=function(e,t){var n=e.input.entry,r=n.studentUsername,o=void 0===r?null:r,i=n.group,a=void 0===i?null:i,u=n.showId;return o||a?a&&a.creatorUsername?Promise.resolve():u?D.a.findByPk(u,{transaction:t,rejectOnEmpty:!0}).then((function(e){return J.a.count({where:{showId:u,studentUsername:o}}).then((function(t){if(t>=e.entryCap)throw new E.UserError("Individual submission limit reached");return Promise.resolve()}))})):Promise.resolve():Promise.reject(new E.UserError("Entry must have an entrant"))},oe=function(e,t){var n=e.input.entry.showId;return n?D.a.findByPk(n,{transaction:t,rejectOnEmpty:!0}).then((function(e){if(M()().isBefore(M()(e.entryEnd)))return Promise.resolve();throw new E.UserError("Submission deadline has ended")})):Promise.resolve()};function ie(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return J.a.findByPk(t.id).then((function(e){return e.update(t.input,{fields:["title","comment","forSale","invited","yearLevel","academicProgram","moreCopies","excludeFromJudging"]})}))}function ae(e,t,n){if(n.authType!==U.a&&!Q(t,n))throw new E.UserError("Permission Denied");return z.a.transaction((function(e){return re(t,e).then((function(){return oe(t,e).then((function(){return Y.a.create({path:t.input.path,horizDimInch:t.input.horizDimInch,vertDimInch:t.input.vertDimInch,mediaType:t.input.mediaType},{transaction:e}).then((function(n){return ne(t.input.entry,U.d,n.id,e)}))}))}))}))}function ue(e,t,n){if(n.authType!==U.a&&!Q(t,n))throw new E.UserError("Permission Denied");var r,o,i,a=(r=t.input.url,o=r.match(/^(?:https?:\/\/|\/\/)?(?:www\.|m\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([\w-]{11})(?![\w-])/i),i=r.match(/^(?:https?:\/\/|\/\/)?(?:www\.|player\.)?vimeo.com\/(?:(?:.*videos?\/)|(?:(?:channels|ondemand).+\/))?(\d+)/i),o&&o[1]?{type:"youtube",id:o[1]}:i&&i[1]?{type:"vimeo",id:i[1]}:{}),u=a.type,s=a.id;if(!u||!s)throw new E.UserError("The video URL must be a valid URL from Youtube or Vimeo");return z.a.transaction((function(e){return re(t,e).then((function(){return oe(t,e).then((function(){return K.a.create({provider:u,videoId:s},{transaction:e}).then((function(n){return ne(t.input.entry,U.h,n.id,e)}))}))}))}))}function se(e,t,n){if(n.authType!==U.a&&!Q(t,n))throw new E.UserError("Permission Denied");return z.a.transaction((function(e){return re(t,e).then((function(){return oe(t,e).then((function(){return W.a.create({path:t.input.path},{transaction:e}).then((function(n){return ne(t.input.entry,U.f,n.id,e)}))}))}))}))}function ce(e,t,n){var r=Promise.resolve(!1);return void 0!==n.username&&n.username===t.studentUsername||n.authType===U.a?r=Promise.resolve(!0):n.authType===U.e&&t.showId&&(r=D.a.findByPk(t.showId,{rejectOnEmpty:!0}).then((function(e){return e.getUsers()})).then((function(e){return e.map((function(e){return e.username})).indexOf(n.username)>=0}))),r.then((function(e){if(!e)throw new E.UserError("Permission Denied");return t.showId||t.portfolioId||t.studentUsername?t.showId?J.a.findAll({where:{showId:t.showId}}):t.portfolioId?J.a.findAll({where:{portfolioId:t.portfolioId}}):t.studentUsername?X.a.findByPk(t.studentUsername).then((function(e){return e.getOwnAndGroupEntries()})):J.a.findAll({where:{args:t}}):J.a.all()}))}var de=n(8);function le(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function pe(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){le(i,r,o,a,u,"next",e)}function u(e){le(i,r,o,a,u,"throw",e)}a(void 0)}))}}function fe(e,t,n){return he.apply(this,arguments)}function he(){return(he=pe(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType===U.g){e.next=2;break}throw new E.UserError("Permission Denied");case 2:return o=n.input,i=o.title,a=o.studentUsername,u=o.portfolioPeriodId,s={title:i,studentUsername:a,portfolioPeriodId:u},e.abrupt("return",de.a.create(s));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e,t){return void 0!==e.username&&e.username===t.studentUsername}function me(e,t,n){return de.a.findByPk(t.id)}function ge(e,t,n){if(t.studentUsername&&n.authType!==U.a&&!ye(n,t))throw new E.UserError("Permission Denied");var r=t.orderBy?{order:[[t.orderBy.sort,t.orderBy.direction]]}:{};if(t.studentUsername){var o={where:{studentUsername:t.studentUsername}};return de.a.findAll(Object.assign({},o,r))}return de.a.findAll(r)}var we=n(1),ve=n.n(we),be=z.a.define("portfolioPeriodJudge",{portfolioPeriodId:{allowNull:!1,type:ve.a.INTEGER,references:{model:"portfolioPeriods",key:"id"},onDelete:"cascade",onUpdate:"cascade"},judgeUsername:{allowNull:!1,type:ve.a.INTEGER,references:{model:"users",key:"username"},onDelete:"cascade",onUpdate:"cascade"}});function Ie(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function Se(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ie(i,r,o,a,u,"next",e)}function u(e){Ie(i,r,o,a,u,"throw",e)}a(void 0)}))}}var Pe=z.a.define("portfolioPeriod",{name:{type:ve.a.STRING,allowNull:!0},description:{type:ve.a.STRING,allowNull:!0},startDate:{type:ve.a.DATE,allowNull:!1,notEmpty:!0},endDate:{type:ve.a.DATE,allowNull:!1,notEmpty:!0},judgingStartDate:{type:ve.a.DATE,allowNull:!1,notEmpty:!0},judgingEndDate:{type:ve.a.DATE,allowNull:!1,notEmpty:!0}});Pe.prototype.getPortfolios=function(){return de.a.findAll({where:{portfolioPeriodId:this.id}})},Pe.prototype.getJudges=function(){var e=Se(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be.findAll({where:{portfolioPeriodId:this.id}});case 2:return t=e.sent,e.next=5,t.map(function(){var e=Se(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X.a.findOne({where:{username:t.judgeUsername}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}();var Oe=Pe,Ee=n(16),De=n.n(Ee);function je(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function Ue(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){je(i,r,o,a,u,"next",e)}function u(e){je(i,r,o,a,u,"throw",e)}a(void 0)}))}}function Te(e,t,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=Ue(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u,s,c,d,l,p,f,h,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType===U.a){e.next=2;break}throw new E.UserError("Permission Denied");case 2:return o=n.input,i=o.description,a=o.name,u=o.startDate,s=o.endDate,c=o.judgingStartDate,d=o.judgingEndDate,l=De()(u).tz("America/New_York").startOf("day"),p=De()(s).tz("America/New_York").endOf("day"),f=De()(c).tz("America/New_York").startOf("day"),h=De()(d).tz("America/New_York").endOf("day"),y={startDate:l,endDate:p,judgingStartDate:f,judgingEndDate:h},"string"==typeof i&&(y.description=i),"string"==typeof a&&(y.name=a),e.abrupt("return",Oe.create(y));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return Oe.findByPk(t.id).then((function(e){return e.update(t.input,{fields:["name","description","startDate","endDate","judgingStartDate","judgingEndDate"]})}))}function xe(e,t,n){return ke.apply(this,arguments)}function ke(){return(ke=Ue(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType===U.a){e.next=2;break}throw new E.UserError("Permission Denied");case 2:if(o=n.input,i=o.portfolioPeriodId,a=o.usernames,i=parseInt(i),!isNaN(i)){e.next=6;break}throw new E.UserError("Portfolio Period Id must be a number");case 6:if(Array.isArray(a)&&0!==a.length){e.next=8;break}throw new E.UserError("Judge username must be a string");case 8:u=0;case 9:if(!(u<a.length)){e.next=23;break}if("string"==typeof(s=a[u])){e.next=13;break}return e.abrupt("continue",20);case 13:return e.next=15,be.findOne({where:{portfolioPeriodId:i,judgeUsername:s}});case 15:if(null===e.sent){e.next=18;break}return e.abrupt("continue",20);case 18:return e.next=20,be.create({portfolioPeriodId:i,judgeUsername:s});case 20:u++,e.next=9;break;case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(e,t,n){return Re.apply(this,arguments)}function Re(){return(Re=Ue(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType===U.a){e.next=2;break}throw new E.UserError("Permission Denied");case 2:if(o=n.portfolioPeriodId,i=n.usernames,o=parseInt(o),!isNaN(o)){e.next=6;break}throw new E.UserError("Portfolio Period Id must be a number");case 6:if(Array.isArray(i)&&0!==i.length){e.next=8;break}throw new E.UserError("Judge username must be a string");case 8:a=0;case 9:if(!(a<i.length)){e.next=23;break}if("string"==typeof(u=i[a])){e.next=13;break}return e.abrupt("continue",20);case 13:return e.next=15,be.findOne({where:{portfolioPeriodId:o,judgeUsername:u}});case 15:if(null!==e.sent){e.next=18;break}return e.abrupt("continue",20);case 18:return e.next=20,be.destroy({where:{portfolioPeriodId:o,judgeUsername:u}});case 20:a++,e.next=9;break;case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function $e(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ge(i,r,o,a,u,"next",e)}function u(e){Ge(i,r,o,a,u,"throw",e)}a(void 0)}))}}function Ce(e,t,n){return Le.apply(this,arguments)}function Le(){return(Le=$e(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null,n.id){e.next=3;break}return e.abrupt("return",o);case 3:return e.next=5,Oe.findByPk(n.id);case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e,t,n){return _e.apply(this,arguments)}function _e(){return(_e=$e(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType!==U.e){e.next=4;break}return e.next=3,Fe(t,n,r);case 3:return e.abrupt("return",e.sent);case 4:if(o=n.orderBy?{order:[[n.orderBy.sort,n.orderBy.direction]]}:{},!n.active){e.next=9;break}return i=M()().toDate(),a={where:{startDate:{$lte:i},judgingEndDate:{$gte:i}}},e.abrupt("return",Oe.findAll(Object.assign({},a,o)));case 9:if(!n.activeSubmission){e.next=13;break}return u=M()().toDate(),s={where:{startDate:{$lte:u},endDate:{$gte:u}}},e.abrupt("return",Oe.findAll(Object.assign({},s,o)));case 13:if(!n.activeJudging){e.next=17;break}return c=M()().toDate(),d={where:{judgingStartDate:{$lte:c},judgingEndDate:{$gte:c}}},e.abrupt("return",Oe.findAll(Object.assign({},d,o)));case 17:return e.abrupt("return",Oe.findAll(o));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e,t,n){return ze.apply(this,arguments)}function ze(){return(ze=$e(regeneratorRuntime.mark((function e(t,n,r){var o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={where:{judgeUsername:r.username}},e.next=3,be.findAll(o);case 3:if(i=e.sent,Array.isArray(i)){e.next=6;break}return e.abrupt("return",[]);case 6:return a=i.map(function(){var e=$e(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe.findByPk(t.portfolioPeriodId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qe=z.a.define("scholarshipSubmissions",{essayPath:{allowNull:!1,type:ve.a.STRING,onDelete:"cascade",onUpdate:"cascade"},scholarshipId:{allowNull:!1,type:ve.a.INTEGER,references:{model:"scholarships",key:"id"},onDelete:"cascade",onUpdate:"cascade"},portfolioPeriodId:{allowNull:!1,type:ve.a.INTEGER,references:{model:"portfolioPeriods",key:"id"},onDelete:"cascade",onUpdate:"cascade"},portfolioId:{allowNull:!1,type:ve.a.INTEGER,references:{model:"portfolios",key:"id"},onDelete:"cascade",onUpdate:"cascade"}});qe.prototype.getPortfolio=function(){return de.a.findByPk(this.portfolioId)},qe.prototype.getScholarship=function(){return Ye.findByPk(this.scholarshipId)};var Me=qe,Je=z.a.define("scholarship",{name:{type:ve.a.STRING,allowNull:!1,notEmpty:!0},description:{type:ve.a.STRING,allowNull:!0,notEmpty:!1},active:{type:ve.a.BOOLEAN,allowNull:!1}});Je.prototype.getSubmissions=function(){return Me.findAll({where:{scholarshipId:this.id}})},Je.prototype.getSubmissionsByPeriodId=function(e){return"number"==typeof e?Me.findAll({where:{scholarshipId:this.id,portfolioPeriodId:e}}):[]};var Ye=Je;function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){He(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xe(e,t,n){var r=t.id;return Ye.findByPk(r)}function Qe(e,t,n){var r={where:{}},o=t.orderBy?{order:[[t.orderBy.sort,t.orderBy.direction]]}:{};return!0!==t.includeInactive&&(r.where=We(We({},r.where),{},{active:!0})),Ye.findAll(Object.assign({},r,o))}function Ze(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function et(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Ze(i,r,o,a,u,"next",e)}function u(e){Ze(i,r,o,a,u,"throw",e)}a(void 0)}))}}function tt(e,t,n){return nt.apply(this,arguments)}function nt(){return(nt=et(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType===U.a){e.next=2;break}throw new E.UserError("Permission Denied");case 2:return o=n.input,i=o.name,a=o.description,u={name:i,description:a,active:!0},e.abrupt("return",Ye.create(u));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return Ye.findByPk(t.id).then((function(e){return e.update(t.input,{fields:["name","description","active"]})}))}function ot(e,t,n){var r=t.id;return Me.findByPk(r)}function it(e,t,n){var r=t.orderBy,o=t.portfolioId,i=t.portfolioPeriodId,a=t.scholarshipId,u={where:{}};isNaN(o)||(u.where.portfolioId=o),isNaN(i)||(u.where.portfolioPeriodId=i),isNaN(a)||(u.where.scholarshipId=a);var s=r?{order:[[r.sort,r.direction]]}:{};return Me.findAll(Object.assign({},u,s))}function at(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}function ut(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){at(i,r,o,a,u,"next",e)}function u(e){at(i,r,o,a,u,"throw",e)}a(void 0)}))}}function st(e,t,n){return ct.apply(this,arguments)}function ct(){return(ct=ut(regeneratorRuntime.mark((function e(t,n,r){var o,i,a,u,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.authType===U.g){e.next=2;break}throw new E.UserError("Permission Denied");case 2:return o=n.input,i=o.scholarshipId,a=o.portfolioId,u=o.essayPath,e.next=5,de.a.findByPk(a);case 5:if(s=e.sent){e.next=8;break}throw new E.UserError("No portfolio found with the provided id.");case 8:if(c=s.portfolioPeriodId,i&&c&&a){e.next=11;break}throw new E.UserError("Missing required fields");case 11:return e.next=13,Me.findOne({where:{scholarshipId:i,portfolioId:a,portfolioPeriodId:c}});case 13:if(!e.sent){e.next=16;break}throw new E.UserError("You've already submitted to this scholarship with this portfolio.");case 16:return d={scholarshipId:i,portfolioId:a,portfolioPeriodId:c,essayPath:u},e.abrupt("return",Me.create(d));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dt={Show:{judges:function(e){return e.getUsers()},entries:function(e,t,n){return n.authType===U.a||n.authType===U.e?e.getEntries():X.a.findByPk(n.username).then((function(t){return t.getOwnAndGroupEntries(e.id)}))},ownVotes:function(e,t,n){return J.a.findAll({where:{showId:e.id}}).then((function(e){var t=e.map((function(e){return e.id}));return j.a.findAll({where:{judgeUsername:n.username,entryId:t}})}))}}},lt=n(23),pt=n(11),ft=n.n(pt),ht=n(14),yt=n.n(ht);function mt(e){return function(e){if(Array.isArray(e))return vt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||wt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||wt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wt(e,t){if(e){if("string"==typeof e)return vt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vt(e,t):void 0}}function vt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var bt=b.a.get("upload:imageDir"),It=b.a.get("upload:pdfDir"),St=Object(lt.promisify)(ft.a.unlink);function Pt(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");var r=De()(t.input.entryStart).tz("America/New_York").startOf("day"),o=De()(t.input.entryEnd).tz("America/New_York").endOf("day"),i=De()(t.input.judgingStart).tz("America/New_York").startOf("day"),a=De()(t.input.judgingEnd).tz("America/New_York").endOf("day"),u={name:t.input.name,description:t.input.description,entryStart:r,entryEnd:o,judgingStart:i,judgingEnd:a,entryCap:t.input.entryCap};return D.a.create(u)}function Ot(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return D.a.findByPk(t.id).then((function(e){return e.update(t.input,{fields:["name","description","entryStart","entryEnd","judgingStart","judgingEnd","entryCap","finalized"]})}))}function Et(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return z.a.transaction((function(e){return D.a.findByPk(t.id,{transaction:e}).then((function(n){return n?J.a.findAll({where:{showId:t.id},transaction:e}).then((function(t){var n=t.filter((function(e){return e.entryType===U.d})).map((function(e){return e.entryId})),r=t.filter((function(e){return e.entryType===U.h})).map((function(e){return e.entryId})),o=t.filter((function(e){return e.entryType===U.f})).map((function(e){return e.entryId}));return Promise.all([Y.a.findAll({where:{id:{$in:n}},transaction:e}),W.a.findAll({where:{id:{$in:o}},transaction:e})]).then((function(e){var t=gt(e,2),n=t[0],r=t[1],o=[].concat(mt(n.map((function(e){return e.path}))),mt(r.map((function(e){return e.path})))).filter((function(e){return null!==e})).reduce((function(e,t){if(t.endsWith(".jpg")){var n=yt.a.parse(t);return[].concat(mt(e),[t,"".concat(n.dir,"/").concat(n.name,"_thumb").concat(n.ext)])}return[].concat(mt(e),[t])}),[]).map((function(e){if(e.endsWith(".pdf"))return"".concat(It,"/").concat(e);if(e.endsWith(".jpg"))return"".concat(bt,"/").concat(e);throw new Error("unknown extension for path: ".concat(e))})).map((function(e){return St(e)}));return Promise.all(o)})).then((function(){return Promise.all([Y.a.destroy({where:{id:{$in:n}},transaction:e}),K.a.destroy({where:{id:{$in:r}},transaction:e}),W.a.destroy({where:{id:{$in:o}},transaction:e})])}))})).then((function(){return n.destroy({transaction:e})})):Promise.resolve(!0)}))}))}function Dt(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return D.a.findOne({where:{id:t.showId}}).then((function(e){if(null===e)throw new E.UserError("Show Not Found");if(t.usernames.length<1)throw new E.UserError("Please input one or more usernames");return e.addUsers(t.usernames).catch((function(){throw new E.UserError("Cannot find one or more usernames")}))})).then((function(){return!0}))}function jt(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");if(t.usernames.length<1)throw new E.UserError("Please input one or more usernames");return z.a.transaction((function(e){return D.a.findOne({where:{id:t.showId},transaction:e}).then((function(n){if(null===n)throw new E.UserError("Show Not Found");return n.removeUsers(t.usernames,{transaction:e})})).then((function(){return J.a.findAll({where:{showId:t.showId},transaction:e})})).then((function(n){var r=n.map((function(e){return e.id}));return j.a.destroy({where:{entryId:r,judgeUsername:t.usernames},transaction:e})}))})).then((function(){return!0}))}function Ut(e,t,n){return D.a.findByPk(t.id)}function Tt(e,t,n){if(t.studentUsername&&n.authType!==U.a&&!ye(n,t))throw new E.UserError("Permission Denied");var r=t.orderBy?{order:[[t.orderBy.sort,t.orderBy.direction]]}:{};return t.studentUsername?X.a.findByPk(t.studentUsername).then((function(e){return e.getOwnAndGroupEntries().then((function(e){var t={where:{$or:[{id:e.map((function(e){return e.showId}))},n.authType!==U.a?{$and:[{entryStart:{$lt:new Date}},{entryEnd:{$gt:new Date}}]}:{}]}};return D.a.findAll(Object.assign({},t,r))}))})):D.a.findAll(r)}var Nt={User:{shows:function(e,t){var n;switch(e.type){case U.g:return[];case U.a:n=D.a.findAll.bind(D.a);break;case U.e:n=e.getShows.bind(e)}return t.date?n({where:{judgingEnd:{$gte:t.date}},order:[["judgingStart","DESC"]]}):n({order:[["judgingStart","DESC"]]})}}};function At(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?At(Object(n),!0).forEach((function(t){kt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Bt=function(e,t,n,r){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return X.a.findOne({where:{username:t.input.username}}).then((function(e){if(null===e){var n=xt(xt({},t.input),{},{type:r});return X.a.create(n)}if(e.type===r)throw new E.UserError("Username Already Exists");if(e.type===U.e&&r===U.g)throw new E.UserError("Judges cannot be converted to Students");if(e.type===U.a)throw new E.UserError("Administrators cannot have their role changed");return e.type=r,e.firstName=t.input.firstName,e.lastName=t.input.lastName,e.save()}))},Rt=function(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return X.a.findOne({where:{username:t.input.username}}).then((function(e){if(null===e)throw new E.UserError("User Does Not Exist");return null==t.input.hometown?e.hometown=null:e.hometown=t.input.hometown,e.save()}))},Gt=function(e,t,n){return Bt(0,t,n,U.a)},$t=function(e,t,n){return Bt(0,t,n,U.e)};function Ct(e,t,n){var r=void 0!==n.username&&n.username===t.id;if(n.authType!==U.a&&!r)throw new E.UserError("Permission Denied");return X.a.findByPk(t.id)}function Lt(e,t,n){if(!n.username)throw new E.UserError("Permission Denied");return X.a.findByPk(n.username)}function Vt(e,t,n){if(n.authType!==U.a)throw new E.UserError("Permission Denied");return t.type===U.g?X.a.findAll({where:{type:U.g}}):t.type===U.e?X.a.findAll({where:{type:U.e}}):t.type===U.a?X.a.findAll({where:{type:U.a}}):X.a.findAll()}function _t(e,t,n){if(!(void 0!==n.username&&(n.authType===U.e||n.authType===U.a)&&n.username===t.input.judgeUsername))throw new E.UserError("Permission Denied");var r,o,i,a=t.input;return(r=a.judgeUsername,o=a.entryId,i=n.authType,i===U.a?Promise.resolve():i===U.g?Promise.reject(new E.UserError("Students may not vote")):X.a.findByPk(r).then((function(e){return J.a.findByPk(o).then((function(t){return t?e.getShows().then((function(e){return 0===e.filter((function(e){return e.id===t.showId})).length?Promise.reject(new E.UserError("Judge is not allowed to vote on this entry")):Promise.resolve()})):Promise.reject(new E.UserError("Cannot find entry"))}))}))).then((function(){return j.a.findOrCreate({where:{judgeUsername:a.judgeUsername,entryId:a.entryId},defaults:{value:a.value}}).then((function(e){var t=e[0];return e[1]?t:t.update({value:a.value})}))}))}function Ft(e,t,n){var r=void 0!==n.username&&n.authType===U.e&&n.username===t.judgeUsername;if(n.authType!==U.a&&!r)throw new E.UserError("Permission Denied");return J.a.findAll({where:{showId:t.showId}}).then((function(e){var r=e.map((function(e){return e.id}));return function(e,t,n){return t!==U.a||e?j.a.findAll({where:{judgeUsername:e,entryId:n}}):j.a.findAll({where:{entryId:n}})}(t.judgeUsername,n.authType,r)}))}function zt(e,t,n){var r=void 0!==n.username&&n.authType===U.e&&n.username===t.judgeUsername;if(n.authType!==U.a&&!r)throw new E.UserError("Permission Denied");return j.a.findOne({where:{judgeUsername:t.judgeUsername,entryId:t.entryId}})}function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(n),!0).forEach((function(t){Jt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Yt,Kt=Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt({},N),B),C),F),Nt),O),{Group:{creator:function(e){return e.getCreator()}}}),{Portfolio:{entries:function(e,t,n){return e.getEntries()}}}),{Scholarship:{submissions:function(e,t,n){return e.getSubmissions()}}}),{ScholarshipSubmission:{portfolio:function(e,t,n){return e.getPortfolio()},scholarship:function(e,t,n){return e.getScholarship()}}}),dt),{PortfolioPeriod:{judges:function(e,t,n){return e.getJudges()},portfolios:function(e,t,n){return e.getPortfolios()}}}),{Vote:{judge:function(e){return e.getJudge()},entry:function(e){return e.getEntry()}}}),{},{Query:Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt({},o),a),c),l),h),s),m),w),Mutation:Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt({},r),i),u),d),p),f),y),g)});var Wt,Ht,Xt=Object(I.gql)(Yt||(Wt=["\nscalar Date\n\ntype User {\n    username: ID!\n    firstName: String!\n    lastName: String!\n    displayName: String\n    hometown: String\n    type: UserType!\n    entries: [Entry]\n    shows(date: Date): [Show]\n}\n\ninput UserInput {\n    username: String!\n    firstName: String!\n    lastName: String!\n    displayName: String\n    hometown: String\n}\n\ninput PermissionInput {\n    username: String!\n    type: UserType\n}\n\ntype Group {\n    id: ID!\n    creator: User!\n    participants: String!\n}\n\ninput GroupInput {\n    creatorUsername: String!\n    participants: String!\n}\n\ntype PortfolioPeriod {\n    id: ID!\n    name: String\n    description: String\n    startDate: Date!\n    endDate: Date!\n    judges: [User]\n    judgingStartDate: Date!\n    judgingEndDate: Date!\n    portfolios: [Portfolio]\n    createdAt: Date!\n    updatedAt: Date!\n}\n\ninput PortfolioPeriodInput {\n    name: String\n    description: String\n    startDate: Date!\n    endDate: Date!\n    judgingStartDate: Date!\n    judgingEndDate: Date!\n}\n\ninput PortfolioPeriodUpdate {\n    name: String\n    description: String\n    startDate: Date\n    endDate: Date\n    judgingStartDate: Date\n    judgingEndDate: Date\n}\n\ntype PortfolioPeriodJudge {\n    portfolioPeriodId: ID!\n    judgeUsername: String!\n}\n\ninput PortfolioPeriodJudgeInput {\n    portfolioPeriodId: Int!\n    usernames: [String]!\n}\n\ntype Portfolio {\n    id: ID!\n    title: String!\n    studentUsername: String!\n    description: String\n    portfolioPeriodId: ID\n    entries: [Entry]\n    createdAt: Date!\n    updatedAt: Date!\n}\n\ninput PortfolioInput {\n    title: String!\n    description: String\n    studentUsername: String\n    portfolioPeriodId: String\n}\n\ninput ScholarshipInput {\n    name: String!\n    description: String!\n}\n\ninput UpdateScholarshipInput {\n    name: String\n    description: String\n    active: Boolean\n}\n\ntype Scholarship {\n    id: ID!\n    active: Boolean\n    name: String!\n    description: String\n    submissions: [Portfolio]\n}\n\ninput ScholarshipSubmissionInput {\n    scholarshipId: Int!\n    portfolioId: Int!\n    essayPath: String!\n}\n\ntype ScholarshipSubmission {\n    id: ID!\n    scholarshipId: Int\n    scholarship: Scholarship\n    portfolioPeriodId: Int\n    portfolioId: Int\n    portfolio: Portfolio\n    essayPath: String\n}\n\ntype Show {\n    id: ID!\n    name: String!\n    description: String\n    entryStart: Date!\n    entryEnd: Date!\n    judgingStart: Date!\n    judgingEnd: Date!\n    entryCap: Int!\n    finalized: Boolean\n    entries: [Entry]\n    judges: [User]\n    ownVotes: [Vote]\n    createdAt: Date!\n    updatedAt: Date!\n}\n\ninput ShowInput {\n    name: String!\n    description: String\n    entryStart: Date!\n    entryEnd: Date!\n    judgingStart: Date!\n    judgingEnd: Date!\n    entryCap: Int!\n}\n\ninput ShowUpdate {\n    name: String\n    description: String\n    entryStart: Date\n    entryEnd: Date\n    judgingStart: Date\n    judgingEnd: Date\n    entryCap: Int\n    finalized: Boolean\n}\n\ntype Vote {\n    id: ID!\n    judge: User\n    entry: Entry\n    value: Int!\n}\n\ninput VoteInput {\n    judgeUsername: String!\n    entryId: Int!\n    value: Int!\n}\n\ninterface Entry {\n    id: ID!\n    distributionAllowed: Boolean\n    group: Group\n    student: User\n    show: Show\n    portfolioId: Int\n    title: String\n    comment: String\n    forSale: Boolean\n    invited: Boolean\n    yearLevel: String\n    academicProgram: String\n    moreCopies: Boolean\n    score: Float\n    entryType: String\n    votes: [Vote]\n    excludeFromJudging: Boolean\n}\n\ninput EntryInput {\n    group: GroupInput\n    distributionAllowed: Boolean\n    studentUsername: String\n    showId: Int\n    portfolioId: Int\n    title: String!\n    comment: String\n    forSale: Boolean\n    hometown: String\n    displayName: String\n    yearLevel: String\n    academicProgram: String\n    moreCopies: Boolean\n}\n\ninput EntryUpdate {\n    title: String\n    comment: String\n    forSale: Boolean\n    invited: Boolean\n    yearLevel: String\n    academicProgram: String\n    moreCopies: Boolean\n    excludeFromJudging: Boolean\n}\n\ntype Photo implements Entry {\n    id: ID!\n    group: Group\n    distributionAllowed: Boolean\n    student: User\n    show: Show\n    portfolioId: Int\n    title: String\n    comment: String\n    forSale: Boolean\n    invited: Boolean\n    yearLevel: String\n    academicProgram: String\n    moreCopies: Boolean\n    score: Float\n    entryType: String\n    votes: [Vote]\n    excludeFromJudging: Boolean\n\n    path: String!\n    horizDimInch: Float\n    vertDimInch: Float\n    mediaType: String\n}\n\ninput PhotoInput {\n    entry: EntryInput\n    path: String!\n    horizDimInch: Float!\n    vertDimInch: Float!\n    mediaType: String!\n}\n\ntype Video implements Entry {\n    id: ID!\n    group: Group\n    student: User\n    distributionAllowed: Boolean\n    show: Show\n    portfolioId: Int\n    title: String\n    comment: String\n    forSale: Boolean\n    invited: Boolean\n    yearLevel: String\n    academicProgram: String\n    moreCopies: Boolean\n    score: Float\n    entryType: String\n    votes: [Vote]\n    excludeFromJudging: Boolean\n\n    provider: String!\n    videoId: String!\n}\n\ninput VideoInput {\n    entry: EntryInput\n    url: String!\n}\n\ntype OtherMedia implements Entry {\n    id: ID!\n    group: Group\n    distributionAllowed: Boolean\n    student: User\n    show: Show\n    portfolioId: Int\n    title: String\n    comment: String\n    forSale: Boolean\n    invited: Boolean\n    yearLevel: String\n    academicProgram: String\n    moreCopies: Boolean\n    score: Float\n    entryType: String\n    votes: [Vote]\n    excludeFromJudging: Boolean\n\n    path: String!\n}\n\ninput OtherMediaInput {\n    entry: EntryInput\n    path: String\n}\n\nenum UserType {\n    STUDENT\n    ADMIN\n    JUDGE\n}\n\ntype Query {\n    self: User\n    user(id: ID!): User\n    users(type: UserType): [User]\n    group(id: ID!): Group\n    portfolio(id: ID!): Portfolio\n    portfolioPeriod(id: ID): PortfolioPeriod\n    portfolioPeriods(orderBy: OrderByItem, active: Boolean, activeSubmission: Boolean, activeJudging: Boolean): [PortfolioPeriod]\n    portfolios(orderBy: OrderByItem, studentUsername: String): [Portfolio]\n    scholarship(id: ID): Scholarship\n    scholarships(orderBy: OrderByItem, includeInactive: Boolean): [Scholarship]\n    scholarshipSubmission(id: ID): ScholarshipSubmission\n    scholarshipSubmissions(orderBy: OrderByItem, portfolioId: Int, portfolioPeriodId: Int, scholarshipId: Int): [ScholarshipSubmission]\n    show(id: ID!): Show\n    groups: [Group]\n    shows(orderBy: OrderByItem, studentUsername: String): [Show]\n    vote(entryId: ID!, judgeUsername: String!): Vote\n    votes(showId: ID!, judgeUsername: String): [Vote]\n    photo(id: ID!): Photo\n    video(id: ID!): Video\n    otherMedia(id: ID!): OtherMedia\n    entry(id: ID!): Entry\n    entries(showId: ID, studentUsername: String): [Entry]\n}\n\ntype Mutation {\n    createJudge(input: UserInput!): User\n    createAdmin(input: UserInput!): User\n    updatePermissions(input: PermissionInput!): User\n    updateUser(input: UserInput!): User\n    deleteUser(id: ID!): User\n\n    createScholarship(input: ScholarshipInput!): Scholarship\n    \n    updateScholarship(id: ID!, input: UpdateScholarshipInput!): Scholarship\n\n    createScholarshipSubmission(input: ScholarshipSubmissionInput!): ScholarshipSubmission\n\n    createShow(input: ShowInput!): Show\n    updateShow(id: ID!, input: ShowUpdate!): Show\n    deleteShow(id: ID!): Boolean\n    assignToShow(showId: ID!, usernames: [String]!): Boolean\n    removeFromShow(showId: ID!, usernames: [String]!): Boolean\n\n    createPortfolio(input: PortfolioInput!): Portfolio\n\n    assignJudgesToPortfolioPeriod(input: PortfolioPeriodJudgeInput! ): Boolean\n    removeJudgesFromPortfolioPeriod(portfolioPeriodId: ID!, usernames: [String]!): Boolean\n    createPortfolioPeriod(input: PortfolioPeriodInput!): PortfolioPeriod\n    updatePortfolioPeriod(id: ID!, input: PortfolioPeriodUpdate!): PortfolioPeriod\n\n    createPhoto(input: PhotoInput!): Show\n    createVideo(input: VideoInput!): Show\n    createOtherMedia(input: OtherMediaInput!): Show\n    updateEntry(id: ID!, input: EntryUpdate!): Entry\n\n    vote(input: VoteInput): Vote\n}\n\nenum SortDirection {\n    ASC\n    DESC\n}\n\ninput OrderByItem {\n    sort: String!\n    direction: SortDirection!\n}\n"],Ht||(Ht=Wt.slice(0)),Yt=Object.freeze(Object.defineProperties(Wt,{raw:{value:Object.freeze(Ht)}})))),Qt=new I.ApolloServer({typeDefs:Xt,resolvers:Kt,context:function(e){var t=e.req;return{authType:t.auth.type,username:t.auth.username}}});function Zt(e,t,n,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,o)}(function(){var e,t=(e=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qt.start();case 2:Qt.applyMiddleware({app:v.a}),t=b.a.get("PORT")||3e3,v.a.listen(t,(function(){console.log("Express server listening on port ".concat(t))}));case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Zt(i,r,o,a,u,"next",e)}function u(e){Zt(i,r,o,a,u,"throw",e)}a(void 0)}))});return function(){return t.apply(this,arguments)}})()()}]);
//# sourceMappingURL=main.map