{"chunk":0,"numChunks":1,"fileHash":"dSclTqw8A8rxiqW5rD0QP6ED6U5PF9fC7mcFhVbQQHE=","filePath":"backend/resolvers/types/showType.js","content":"import User from '../../models/user'\r\nimport Entry from '../../models/entry'\r\nimport Vote from '../../models/vote'\r\nimport { ADMIN, JUDGE } from '../../constants'\r\n\r\nexport default {\r\n  Show: {\r\n    judges (show) {\r\n      return show.getUsers()\r\n    },\r\n    entries (show, _, context) {\r\n      // Admins and judges should see all entries on a show\r\n      if (context.authType === ADMIN || context.authType === JUDGE) {\r\n        return show.getEntries()\r\n      } else {\r\n        return User.findByPk(context.username)\r\n          .then((user) => {\r\n            return user.getOwnAndGroupEntries(show.id)\r\n          })\r\n      }\r\n    },\r\n    ownVotes (show, _, context) {\r\n      return Entry.findAll({ where: { showId: show.id } }).then((showEntries) => {\r\n        // search for the entires that match the permission constraints\r\n        const entryIds = showEntries.map(entry => entry.id)\r\n        return Vote.findAll({\r\n          where: {\r\n            judgeUsername: context.username,\r\n            entryId: entryIds\r\n          }\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n"}