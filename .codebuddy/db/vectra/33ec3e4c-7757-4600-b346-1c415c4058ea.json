{"chunk":0,"numChunks":1,"fileHash":"UTt7V2Dpu/yuAJ03TGNQH9WJt0qDKCh/0TnUbCq4v+4=","filePath":"backend/models/show.js","content":"import DataTypes from 'sequelize'\r\nimport sequelize from '../config/sequelize'\r\nimport Entry from './entry'\r\n\r\nconst Show = sequelize.define('show', {\r\n  name: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n    notEmpty: true\r\n  },\r\n  description: {\r\n    type: DataTypes.STRING,\r\n    allowNull: false,\r\n    defaultValue: ''\r\n  },\r\n  entryCap: {\r\n    type: DataTypes.INTEGER,\r\n    allowNull: false,\r\n    min: 1\r\n  },\r\n  entryStart: {\r\n    type: DataTypes.DATE,\r\n    allowNull: false\r\n  },\r\n  entryEnd: {\r\n    type: DataTypes.DATE,\r\n    allowNull: false\r\n  },\r\n  judgingStart: {\r\n    type: DataTypes.DATE,\r\n    allowNull: false\r\n  },\r\n  judgingEnd: {\r\n    type: DataTypes.DATE,\r\n    allowNull: false\r\n  },\r\n  finalized: {\r\n    type: DataTypes.BOOLEAN,\r\n    allowNull: false,\r\n    defaultValue: false\r\n  }\r\n},\r\n{\r\n  validate: {\r\n    entryAndJudingDateValidation () {\r\n      const entryStart = new Date(this.entryStart)\r\n      const entryEnd = new Date(this.entryEnd)\r\n      const judgingStart = new Date(this.judgingStart)\r\n      const judgingEnd = new Date(this.judgingEnd)\r\n\r\n      if (entryStart > entryEnd) {\r\n        throw new Error('Entry start date must be before the entry end date')\r\n      } else if (entryEnd >= judgingStart) {\r\n        throw new Error('Entry end date must be before or equal to the judging start date')\r\n      } else if (judgingStart > judgingEnd) {\r\n        throw new Error('Judging start date must be before the judging end date')\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\nShow.prototype.getEntries = function getEntries () {\r\n  return Entry.findAll({ where: { showId: this.id } })\r\n}\r\n\r\nexport default Show\r\n"}