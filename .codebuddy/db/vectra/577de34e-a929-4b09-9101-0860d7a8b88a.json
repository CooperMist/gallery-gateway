{"chunk":0,"numChunks":1,"fileHash":"Wv2g1tPKBUAwvbWJIhpKrJw/cZ3U+MlncnCu5F8ImGI=","filePath":"backend/models/portfolioRating.js","content":"import User from './user'\r\nimport DataTypes from 'sequelize'\r\nimport sequelize from '../config/sequelize'\r\nimport { IMAGE_ENTRY, VIDEO_ENTRY, OTHER_ENTRY } from '../constants'\r\nimport { ALLOWED_RATING_VALUES } from '../constants'\r\n\r\nconst PortfolioRating = sequelize.define('portfolioRating', {\r\n  // id of portfolio submitted\r\n  portfolioId: {\r\n    allowNull: false,\r\n    type: DataTypes.INTEGER,\r\n    references: {\r\n      model: 'portfolios',\r\n      key: 'id'\r\n    },\r\n    onDelete: 'cascade',\r\n    onUpdate: 'cascade'\r\n  },\r\n  value: {\r\n    type: DataTypes.INTEGER,\r\n    defaultValue: 0,\r\n    allowNull: false\r\n  },\r\n    // The username of the judge for the Portfolio Period\r\n    judgeUsername: {\r\n    allowNull: false,\r\n    type: DataTypes.INTEGER,\r\n    references: {\r\n        model: 'users',\r\n        key: 'username'\r\n    },\r\n    onDelete: 'cascade',\r\n    onUpdate: 'cascade'\r\n},\r\n  createdAt: {\r\n    allowNull: false,\r\n    type: DataTypes.DATE\r\n  },\r\n  updatedAt: {\r\n    allowNull: false,\r\n    type: DataTypes.DATE\r\n  }\r\n},\r\n{\r\n    validate: {\r\n        ratingValueValidation () {\r\n          if (!ALLOWED_RATING_VALUES.has(this.value)) {\r\n            throw new Error('Rating value must be an integer between 1 and 5 inclusive.')\r\n          }\r\n        }\r\n      }\r\n})\r\n\r\n\r\n\r\nPortfolioRating.getRatingsByPortfolioPeriod = function getRatingsByPortfolioPeriod (portfolioPeriodId) {\r\n  return sequelize.query(\r\n    `SELECT pr.portfolioId, pr.value, pr.judgeUsername\r\n     FROM portfolioRatings pr\r\n     INNER JOIN scholarshipSubmissions ss ON pr.portfolioId = ss.portfolioId\r\n     WHERE ss.portfolioPeriodId = :portfolioPeriodId`,\r\n    {\r\n      replacements: { portfolioPeriodId: portfolioPeriodId },\r\n      type: sequelize.QueryTypes.SELECT\r\n    }\r\n  )\r\n}\r\n\r\nexport default PortfolioRating\r\n"}