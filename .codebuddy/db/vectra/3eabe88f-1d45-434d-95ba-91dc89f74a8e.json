{"chunk":3,"numChunks":5,"fileHash":"cWvoqHYwuGtipLnIZtCfp761H+eBYWHJZUhvVs+lyqI=","filePath":"deploy/deploy.sh","content":"#! /bin/bash\nsudo tee /opt/node/gallerygateway/.env > /dev/null << ENDENV\nABSTRACTION_DB_NAME=gallerygateway\nABSTRACTION_DB_USER=gallerygateway\nABSTRACTION_DB_HOST=localhost\nABSTRACTION_DB_PASS=`cat $SCRIPT_ROOT/mysql_password.txt`\nSAML_CALLBACK_URL=https://gallerygateway.rit.edu/backend/auth/login/callback\nSAML_ENTRY_POINT=https://login.cad.rit.edu/saml2/idp/SSOService.php\nISSUER=https://gallerygateway.rit.edu\nSAML_SUCCESS_URL=https://gallerygateway.rit.edu\nENDENV\n#\n# Move the supervisor config into place\n#\nsudo rm -f /etc/supervisor/conf.d/gallerygateway.conf\nsudo tee /etc/supervisor/conf.d/gallerygateway.conf > /dev/null << SUPERVISORCONF\n[program:gallerygateway]\ncommand=/usr/bin/node /opt/node/gallerygateway/main.js\ndirectory=/opt/node/gallerygateway\nredirect_stderr=true\nenvironment=NODE_ENV=\"production\"\nstdout_logfile=/opt/node/gallerygateway/log.txt\nstdout_logfile_maxbytes=1MB\nstdout_logfile_backups=10\nstdout_capture_maxbytes=1MB\nstdout_events_enabled=false\nstderr_logfile=/opt/node/gallerygateway/err_log.txt\nstderr_logfile_maxbytes=1MB\nstderr_logfile_backups=10\nstderr_capture_maxbytes=1MB\nstderr_events_enabled=false\nuser=$NODE_USER\nSUPERVISORCONF\n#\n# Migrate the database\n#\ncd $PROJECT_ROOT/backend;\ncp /opt/node/gallerygateway/.env .env;\n# Stub some keys -- we don't need them, but they must exist for node to migrate\nmkdir keys;\ntouch keys/idp_cert.pem;\ntouch keys/private.key;\ntouch keys/public.key;\nNODE_ENV=development npm install;\nnpm run migrate;\n#\n# Start new server\n#\nsudo service supervisor restart\n#\n# Warn about"}