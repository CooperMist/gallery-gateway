{"chunk":0,"numChunks":1,"fileHash":"EgYVKe9PEAssNKaxT2Tqw/5Q21TFlmhmoWh495YwYg0=","filePath":"backend/db/migrations/20180424235800-make-user-shows-cascade.js","content":"export function up (queryInterface, Sequelize) {\n  return queryInterface.getForeignKeyReferencesForTable('user_shows')\n    .then(fks => {\n      if (Array.isArray(fks) && fks.length > 0) {\n        const usernameConstraint = fks.find(fk => fk.columnName === 'username')\n        const showIdConstraint = fks.find(fk => fk.columnName === 'showId')\n        return Promise.all([\n          queryInterface.removeConstraint('user_shows', usernameConstraint.constraintName),\n          queryInterface.removeConstraint('user_shows', showIdConstraint.constraintName)\n        ])\n      }\n    })\n    .then(() => {\n      return Promise.all([\n        queryInterface.addConstraint('user_shows', {\n          type: 'FOREIGN KEY',\n          references: {\n            table: 'users',\n            field: 'username'\n          },\n          fields: ['username'],\n          onDelete: 'cascade',\n          onUpdate: 'cascade'\n        }),\n        queryInterface.addConstraint('user_shows', {\n          type: 'FOREIGN KEY',\n          references: {\n            table: 'shows',\n            field: 'id'\n          },\n          fields: ['showId'],\n          onDelete: 'cascade',\n          onUpdate: 'cascade'\n        })\n      ])\n    })\n}"}