{"chunk":43,"numChunks":51,"fileHash":"a+FASeiRPRDZBZ0S/9mF+yVl99YVRCx6NJRkd9d3q0M=","filePath":"backend/routes/download.js","content":"import fs from 'fs'\nfunction buildSubmisionTitlesForDownload(submissions) {\n  const namesSeen = new Set()\n  return submissions.reduce((arr, { user, group, entries }) => {\n    // ['Clark Kent - Daily Planet Office']\n    const newSubmissionSummaries = entries.map((entry) => {\n      const { path, title, invited, entryType } = entry\n      // If this is a group submission, we insert the group participants in the name\n      const entryNamePrefix = `${user.lastName}, ${user.firstName}${group ? ` & ${group.participants}` : ''} - ${title}`\n      // enforce non-conflicting titles by adding (1), (2), ... to end of name\n      let proposedName = entryNamePrefix\n      let i = 1\n      while (namesSeen.has(proposedName)) {\n        // while we've seen this name before, increment and append a number\n        proposedName = `${entryNamePrefix} (${i})`\n        i += 1\n      }\n      namesSeen.add(proposedName)\n\n      const entry_title = {\n        name: `${proposedName}.${entryType === IMAGE_ENTRY ? \"jpg\" : \"pdf\"}`,\n        path,\n        invited,\n        entryType,\n      }\n\n      return entry_title\n    })\n    return [...arr, ...newSubmissionSummaries]\n  }, [])\n}"}