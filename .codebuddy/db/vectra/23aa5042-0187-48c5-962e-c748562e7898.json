{"chunk":23,"numChunks":46,"fileHash":"DQQZubyGjQ+D3H+B2E8TdNYXpgsQLpU9NZS5B8BiEB4=","filePath":"backend/routes/download.js","content":"import fs from 'fs'\nrouter.route('/csv/:showId')\n  .get(ensureAdminDownloadToken, (req, res, next) => {\n    Show.findByPk(req.params.showId, { rejectOnEmpty: true })\n      .then(show => {\n        Entry.findAll({ where: { showId: req.params.showId } })\n          .then(entries => {\n            return Promise.all([\n              .then(([images, videos, otherMedia, submissionsWithSubmitters]) => {\n                // Create a mapping for type objects to their ids for easy assigning\n                const imageIdsToImage = images.reduce((obj, image) => ({\n                  ...obj,\n                  [image.id]: image\n                }), {})\n                const videoIdsToImage = videos.reduce((obj, video) => ({\n                  ...obj,\n                  [video.id]: video\n                }), {})\n                const otherMediaIdsToImage = otherMedia.reduce((obj, other) => ({\n                  ...obj,\n                  [other.id]: other\n                }), {})\n                // Format the data to be csv-stringified"}