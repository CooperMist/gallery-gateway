{"chunk":0,"numChunks":1,"fileHash":"jJiXoMVMRfdP2DBkk7ZDrepybqcJUjbcDjP8q+xosnM=","filePath":"backend/resolvers/mutations/rating.js","content":"import PortfolioRatings from '../../models/portfolioRating'\nimport User from '../../models/user'\nimport { UserError } from 'graphql-errors'\nimport { ADMIN, JUDGE, STUDENT } from '../../constants'\nimport PortfolioPeriodJudge from '../../models/portfolioPeriodJudge'\nimport Portfolio from '../../models/portfolio'\nfunction judgeIsAllowedToVote(judgeUsername, userType, portfolioPeriodId) {\n    // Admins can vote on any show\n    if (userType === ADMIN) {\n      return Promise.resolve();\n    }\n  \n    // Students may not vote\n    if (userType === STUDENT) {\n      return Promise.reject(new UserError('Students may not vote'));\n    }\n  \n    // Judges may only vote on entries submitted to shows they've been assigned to.\n    return PortfolioPeriodJudge.findOne({\n      where: {\n        portfolioPeriodId: portfolioId,\n        judgeUsername: judgeUsername,\n      },\n    }).then((portfolioPeriodJudge) => {\n      if (!portfolioPeriodJudge) {\n        return Promise.reject(\n          new UserError('Judge is not assigned to this portfolio period')\n        );\n      }\n      return Promise.resolve();\n    }\n    );\n}"}