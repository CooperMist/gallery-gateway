{"chunk":0,"numChunks":1,"fileHash":"Bc68ft8CMxnNn7SGnPsJko5e0dljmdiueU2GtsQB9Ug=","filePath":"backend/middleware/parseJwtUser.js","content":"import { parseToken } from '../helpers/jwt'\r\nimport nconf from '../config'\r\nimport { ADMIN } from '../constants'\r\n\r\nexport default async function (req, res, next) {\r\n  // Parse and validate a JWT token included in an Authorization header\r\n  let decoded = {}\r\n  if (req.headers.authorization &&\r\n        req.headers.authorization.indexOf('Bearer ') === 0) {\r\n    const token = req.headers.authorization.substr('Bearer '.length)\r\n    try {\r\n      decoded = await parseToken(token)\r\n    } catch (error) {\r\n      console.error(error)\r\n      decoded = {}\r\n    }\r\n  }\r\n  req.auth = decoded\r\n  req.auth.type = req.auth.type || null\r\n\r\n  // In development, make all GraphiQL requests ADMIN requests\r\n  if (nconf.get('NODE_ENV') === 'development' &&\r\n        req.headers.referer &&\r\n        req.headers.referer.indexOf('http://localhost:3000/graphiql') === 0) {\r\n    req.auth.type = ADMIN\r\n  }\r\n  next()\r\n}\r\n"}